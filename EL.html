 <!DOCTYPE html>
 <html lang="en">
 <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lectura rápida</title>
    <link rel="stylesheet" href="css/master.css">
    <link rel="stylesheet" href="css/section.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
 </head>
 <body>
    <section>
        <div class="header">
            <h2>Lectura Rapida</h2>
        </div>
        <div class="sections">
            <div class=""><a href="">EL</a></div>
            <div class=""><a href="">OE</a></div>
            <div class=""><a href="">EPM</a></div>
            <div class=""><a href="">EVM</a></div>
            <div class=""><a href="">EMD</a></div>
        </div>
        <div class="seleccionar">
            <select name="categoria" id="categoria">
                <option value="">Categoría</option>
                <option value="0">EL1</option>
                <option value="1">EL2</option>
                <option value="2">EL3</option>
                <option value="3">EL4</option>
                <option value="4">EL5</option>
                <option value="5">EL6</option>
                <option value="6">EL7</option>
                <option value="7">EL8</option>
            </select>
            <select name="nivel" id="nivel">
                <option value="">Nivel</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
            </select>
            <button class="start">Comenzar</button>
        </div>
            <h2 class="instrucciones"> <i class="fas fa-exclamation-circle"></i> Instrucciones </h2>
            <hr>
        <div class="pantalla1 hidden">
            <h2 class="numero1"></h2>
            <h2 class="numero2"></h2>
        </div>
        <div class="pantalla2 hidden">
            <h2 class="letra1"></h2>
            <h2 class="letra2"></h2>
        </div>
        <div class="pantalla3 hidden">
            <h2 class="palabra1"></h2>
            <h2 class="palabra2"></h2>
        </div>
        <div class="pantalla4 hidden">
            <h2 class="palabra1"></h2>
            <h2 class="palabra2"></h2>
        </div>
        <div class="pantalla5 hidden">
            <audio class="mp3" src="./mp3/tic.mp3"></audio>
            <div>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
            </div>
        </div>
        <div class="pantalla6 hidden">
            <audio class="mp3" src="./mp3/tic.mp3"></audio>
            <div>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
            </div>
        </div>
        <div class="pantalla7 hidden">
            <audio class="mp3" src="./mp3/tic.mp3"></audio>
            <div>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
            </div>
        </div>
        <div class="pantalla8 hidden">
            <audio class="mp3" src="./mp3/tic.mp3"></audio>
            <div>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
                <h2></h2>
            </div>
        </div>
    </section>

    <script>
        //Elements

        const header = document.querySelector(".header")
        const btnStart = document.querySelector(".start")
        const sections = document.querySelector(".sections")
        const instrucciones = document.querySelector(".instrucciones")
        const categoria = document.querySelector("#categoria")
        const nivel = document.querySelector("#nivel")
        const pantalla = document.querySelector(".pantalla")

        // variables

        let info = []

        //Events

        categoria.addEventListener("change", () => {
            instrucciones.innerHTML = '<i class="fas fa-exclamation-circle"></i>' + "<h2>" + info.instrucciones[categoria.value] + "</h2>"
        })

        fetch('json/EL.json')
        .then(response => response.json())
        .then(data => {
            info = data
        }).catch(error=> console.error('Error: ', error))

        btnStart.addEventListener("click", () => {
            if (categoria.value != "" && nivel.value != "") {
                header.classList.toggle("hidden")
                sections.classList.toggle("hidden")
                if (btnStart.textContent == "Comenzar") {
                    btnStart.textContent = "Detener"
                    if (categoria.value == "0") {
                        el1(true)
                    }
                    if (categoria.value == "1") {
                        el2(true)
                    }
                    if (categoria.value == "2") {
                        el3(true)
                    }
                    if (categoria.value == "3") {
                        el4(true)
                    }
                    if (categoria.value == "4") {
                        el5(true)
                    }
                    if (categoria.value == "5") {
                        el6(true)
                    }
                    if (categoria.value == "6") {
                        el7(true)
                    }
                    if (categoria.value == "7") {
                        el8(true)
                    }
                }else{
                    btnStart.textContent = "Comenzar"
                    if (categoria.value == "0") {
                        el1(false)
                    }
                    if (categoria.value == "1") {
                        el2(false)
                    }
                    if (categoria.value == "2") {
                        el3(false)
                    }
                    if (categoria.value == "3") {
                        el4(false)
                    }
                    if (categoria.value == "4") {
                        el5(false)
                    }
                    if (categoria.value == "5") {
                        el6(false)
                    }
                    if (categoria.value == "6") {
                        el7(false)
                    }
                    if (categoria.value == "7") {
                        el8(false)
                    }
                }
            }
        })

        // functions

        function el1(encendido) {
            const numeros = info.numeros;
            const pantalla = document.querySelector(".pantalla1");
            const num1 = document.querySelector(".pantalla1 .numero1");
            const num2 = document.querySelector(".pantalla1 .numero2");
            if (encendido) {
                const tiempo = 600 - ((parseInt(nivel.value) - 1) * 50);

                pantalla.classList.remove("hidden");

                let contador = 0;
                const intervalo = setInterval(() => {
                    btnStart.addEventListener("click", () => {
                        clearInterval(intervalo)
                    })
                    num1.textContent = numeros[Math.floor(Math.random() * numeros.length)];
                    num2.textContent = numeros[Math.floor(Math.random() * numeros.length)];
                    contador++;
                    if (contador >= 40) clearInterval(intervalo);
                }, tiempo);
            }else{
                pantalla.classList.add("hidden")
            }
        }

        function el2(encendido) {
            const letras = info.letras;
            const vocales = info.vocales;
            const pantalla = document.querySelector(".pantalla2");
            const letra1 = document.querySelector(".pantalla2 .letra1");
            const letra2 = document.querySelector(".pantalla2 .letra2");
            if (encendido) {
                const tiempo = 600 - ((parseInt(nivel.value) - 1) * 50);

                pantalla.classList.remove("hidden");

                let contador = 0;
                const intervalo = setInterval(() => {
                    btnStart.addEventListener("click", () => {
                        clearInterval(intervalo)
                    })
                    letra1.textContent = letras[Math.floor(Math.random() * letras.length)];
                    letra2.textContent = vocales[Math.floor(Math.random() * vocales.length)];
                    contador++;
                    if (contador >= 40) clearInterval(intervalo);
                }, tiempo);
            }else{
                pantalla.classList.add("hidden")
            }
        }

        function el3(encendido) {
            const textos = info.textos;
            const texto = textos[Math.floor(Math.random() * textos.length)];
            const palabras = texto.split(' '); // Dividimos el texto en palabras
            const pantalla = document.querySelector(".pantalla3");
            const palabra1 = document.querySelector(".pantalla3 .palabra1");
            const palabra2 = document.querySelector(".pantalla3 .palabra2");

            if (encendido) {
                const tiempo = 800 - ((parseInt(nivel.value) - 1) * 50);
                pantalla.classList.remove("hidden");

                let indice = 0;
                const intervalo = setInterval(() => {
                    // Si se hace click en btnStart, se detiene
                    btnStart.addEventListener("click", () => {
                        clearInterval(intervalo);
                        // pantalla.classList.add("hidden");
                    });

                    // Mostramos dos palabras (si existen)
                    if (indice < palabras.length) {
                        palabra1.textContent = palabras[indice];
                        indice++;
                    } else {
                        palabra1.textContent = '';
                    }

                    if (indice < palabras.length) {
                        palabra2.textContent = palabras[indice];
                        indice++;
                    } else {
                        palabra2.textContent = '';
                    }

                    // Si hemos llegado al final de las palabras, detenemos el intervalo
                    if (indice >= palabras.length) {
                        clearInterval(intervalo);
                        // Opcional: ocultar la pantalla al terminar
                        pantalla.classList.add("hidden");
                    }
                }, tiempo);
            } else {
                pantalla.classList.add("hidden");
            }
        }

        function el4(encendido) {
            const textos = info.textos;
            const texto = textos[Math.floor(Math.random() * textos.length)];
            const palabras = texto.split(' '); // Dividimos el texto en palabras
            const pantalla = document.querySelector(".pantalla4");
            const palabra1 = document.querySelector(".pantalla4 .palabra1");
            const palabra2 = document.querySelector(".pantalla4 .palabra2");

            if (encendido) {
                const tiempo = 600 - ((parseInt(nivel.value) - 1) * 50);
                pantalla.classList.remove("hidden");

                let indice = 0;
                const intervalo = setInterval(() => {
                    // Si se hace click en btnStart, se detiene
                    btnStart.addEventListener("click", () => {
                        clearInterval(intervalo);
                        // pantalla.classList.add("hidden");
                    });

                    // Mostramos dos palabras (si existen)
                    if (indice < palabras.length) {
                        palabra1.textContent = palabras[indice];
                        indice++;
                    } else {
                        palabra1.textContent = '';
                    }

                    if (indice < palabras.length) {
                        palabra2.textContent = palabras[indice];
                        indice++;
                    } else {
                        palabra2.textContent = '';
                    }

                    // Si hemos llegado al final de las palabras, detenemos el intervalo
                    if (indice >= palabras.length) {
                        clearInterval(intervalo);
                        // Opcional: ocultar la pantalla al terminar
                        pantalla.classList.add("hidden");
                    }
                }, tiempo);
            } else {
                pantalla.classList.add("hidden");
            }
        }

        function el5(encendido) {
            const textos = info.textos;
            const texto = textos[Math.floor(Math.random() * textos.length)];
            const palabras = texto.split(' ');
            const pantalla = document.querySelector(".pantalla5");
            const mp3 = document.querySelector(".pantalla5 .mp3");
            const h2s = pantalla.querySelectorAll("h2");

            if (!encendido) {
                pantalla.classList.add("hidden");
                return;
            }

            const tiempo = 600 - ((parseInt(nivel.value) - 1) * 50);
            pantalla.classList.remove("hidden");

            let palabraIndex = 0;
            let foco = 0;

            function cargarPalabras() {
                for (let i = 0; i < h2s.length; i++) {
                    const palabra1 = palabras[palabraIndex++] || '';
                    const palabra2 = palabras[palabraIndex++] || '';
                    h2s[i].textContent = palabra1 + ' ' + palabra2;
                }
            }

            cargarPalabras();

            const intervalo = setInterval(() => {
                // Reproducir tic
                mp3.currentTime = 0;
                mp3.play();

                // Mostrar y resaltar solo el h2 actual
                h2s.forEach((h2, i) => {
                    h2.style.opacity = i === foco ? "1" : "0.4";
                });

                foco++;

                if (foco >= h2s.length) {
                    // Esperar un tic completo antes de cambiar a nuevas palabras
                    foco = 0;

                    if (palabraIndex < palabras.length) {
                        setTimeout(() => {
                            cargarPalabras();
                        }, tiempo / 2); // opcional: pequeña pausa
                    } else {
                        clearInterval(intervalo);
                        setTimeout(() => pantalla.classList.add("hidden"), tiempo);
                    }
                }
            }, tiempo);

            btnStart.addEventListener("click", () => {
                clearInterval(intervalo);
            });
        }

        function el6(encendido) {
            const textos = info.textos;
            const texto = textos[Math.floor(Math.random() * textos.length)];
            const palabras = texto.split(' ');
            const pantalla = document.querySelector(".pantalla6");
            const mp3 = document.querySelector(".pantalla6 .mp3");
            const h2s = pantalla.querySelectorAll(".pantalla6 h2");

            if (!encendido) {
                pantalla.classList.add("hidden");
                return;
            }

            const tiempo = 600 - ((parseInt(nivel.value) - 1) * 50);
            pantalla.classList.remove("hidden");

            let palabraIndex = 0;
            let foco = 0;

            function cargarPalabras() {
                for (let i = 0; i < h2s.length; i++) {
                    const palabra1 = palabras[palabraIndex++] || '';
                    const palabra2 = palabras[palabraIndex++] || '';
                    const palabra3 = palabras[palabraIndex++] || '';
                    h2s[i].textContent = [palabra1, palabra2, palabra3].filter(Boolean).join(' ');
                }
            }

            cargarPalabras();

            const intervalo = setInterval(() => {
                // Reproducir tic
                mp3.currentTime = 0;
                mp3.play();

                // Mostrar y resaltar solo el h2 actual
                h2s.forEach((h2, i) => {
                    h2.style.opacity = i === foco ? "1" : "0.4";
                });

                foco++;

                if (foco >= h2s.length) {
                    // Esperar un tic completo antes de cambiar a nuevas palabras
                    foco = 0;

                    if (palabraIndex < palabras.length) {
                        setTimeout(() => {
                            cargarPalabras();
                        }, tiempo / 2); // opcional: pequeña pausa
                    } else {
                        clearInterval(intervalo);
                        setTimeout(() => pantalla.classList.add("hidden"), tiempo);
                    }
                }
            }, tiempo);

            btnStart.addEventListener("click", () => {
                clearInterval(intervalo);
            });
        }

        function el7(encendido) {
            const textos = info.textos;
            const texto = textos[Math.floor(Math.random() * textos.length)];
            const palabras = texto.split(' ');
            const pantalla = document.querySelector(".pantalla7");
            const mp3 = pantalla.querySelector(".mp3");
            const h2s = pantalla.querySelectorAll("h2");

            const tiempo = 800 - ((parseInt(nivel.value) - 1) * 50);
            const palabrasPorLinea = 9;
            const palabrasResaltadasPorTic = 3;
            const lineasVisibles = h2s.length;

            let grupoIndex = 0;
            let lineaActual = 0;
            let palabraIndex = 0;
            let intervalo;

            if (encendido) {
                pantalla.classList.remove("hidden");

                function cargarGrupo() {
                    const start = grupoIndex * lineasVisibles * palabrasPorLinea;
                    for (let i = 0; i < lineasVisibles; i++) {
                        const ini = start + i * palabrasPorLinea;
                        const fin = ini + palabrasPorLinea;
                        const fragmento = palabras.slice(ini, fin);

                        if (fragmento.length === 0) {
                            h2s[i].textContent = '';
                            h2s[i].removeAttribute("data-palabras");
                        } else {
                            h2s[i].setAttribute("data-palabras", fragmento.join("|"));
                            h2s[i].textContent = fragmento.join(" ");
                        }
                    }
                    palabraIndex = 0;
                    lineaActual = 0;
                }

                cargarGrupo();

                intervalo = setInterval(() => {
                    if (lineaActual >= lineasVisibles) {
                        grupoIndex++;
                        const inicio = grupoIndex * lineasVisibles * palabrasPorLinea;
                        if (inicio >= palabras.length) {
                            clearInterval(intervalo);
                            pantalla.classList.add("hidden");
                            return;
                        }
                        cargarGrupo();
                        return;
                    }

                    const h2 = h2s[lineaActual];
                    if (!h2 || !h2.hasAttribute("data-palabras")) {
                        lineaActual++;
                        palabraIndex = 0;
                        return;
                    }

                    const rawPalabras = h2.getAttribute("data-palabras").split("|");

                    const resaltarInicio = palabraIndex;
                    const resaltarFin = palabraIndex + palabrasResaltadasPorTic;

                    const html = rawPalabras.map((pal, idx) => {
                        if (idx >= resaltarInicio && idx < resaltarFin) {
                            return `<span class="resaltado">${pal}</span>`;
                        } else {
                            return pal;
                        }
                    }).join(' ');

                    h2.innerHTML = html;
                    mp3.currentTime = 0;
                    mp3.play();

                    palabraIndex += palabrasResaltadasPorTic;

                    if (palabraIndex >= palabrasPorLinea) {
                        setTimeout(() => {
                            h2.innerHTML = rawPalabras.join(" ");
                            palabraIndex = 0;
                            lineaActual++;
                        }, tiempo / 2);
                    }

                }, tiempo);

                btnStart.addEventListener("click", () => {
                    clearInterval(intervalo);
                });

            } else {
                pantalla.classList.add("hidden");
            }
        }

        function el8(encendido) {
            const textos = info.textos;
            const texto = textos[Math.floor(Math.random() * textos.length)];
            const palabras = texto.split(' ');
            const pantalla = document.querySelector(".pantalla8");
            const mp3 = pantalla.querySelector(".mp3");
            const h2s = pantalla.querySelectorAll("h2");

            const tiempo = 600 - ((parseInt(nivel.value) - 1) * 50);
            const palabrasPorLinea = 8;
            const palabrasResaltadasPorTic = 4;
            const lineasVisibles = h2s.length;

            let grupoIndex = 0;
            let lineaActual = 0;
            let palabraIndex = 0;
            let intervalo;

            if (encendido) {
                pantalla.classList.remove("hidden");

                function cargarGrupo() {
                    const start = grupoIndex * lineasVisibles * palabrasPorLinea;
                    for (let i = 0; i < lineasVisibles; i++) {
                        const ini = start + i * palabrasPorLinea;
                        const fin = ini + palabrasPorLinea;
                        const fragmento = palabras.slice(ini, fin);

                        if (fragmento.length === 0) {
                            h2s[i].textContent = '';
                            h2s[i].removeAttribute("data-palabras");
                        } else {
                            h2s[i].setAttribute("data-palabras", fragmento.join("|"));
                            h2s[i].textContent = fragmento.join(" ");
                        }
                    }
                    palabraIndex = 0;
                    lineaActual = 0;
                }

                cargarGrupo();

                intervalo = setInterval(() => {
                    if (lineaActual >= lineasVisibles) {
                        grupoIndex++;
                        const inicio = grupoIndex * lineasVisibles * palabrasPorLinea;
                        if (inicio >= palabras.length) {
                            clearInterval(intervalo);
                            pantalla.classList.add("hidden");
                            return;
                        }
                        cargarGrupo();
                        return;
                    }

                    const h2 = h2s[lineaActual];
                    if (!h2 || !h2.hasAttribute("data-palabras")) {
                        lineaActual++;
                        palabraIndex = 0;
                        return;
                    }

                    const rawPalabras = h2.getAttribute("data-palabras").split("|");

                    const resaltarInicio = palabraIndex;
                    const resaltarFin = palabraIndex + palabrasResaltadasPorTic;

                    const html = rawPalabras.map((pal, idx) => {
                        if (idx >= resaltarInicio && idx < resaltarFin) {
                            return `<span class="resaltado">${pal}</span>`;
                        } else {
                            return pal;
                        }
                    }).join(' ');

                    h2.innerHTML = html;
                    mp3.currentTime = 0;
                    mp3.play();

                    palabraIndex += palabrasResaltadasPorTic;

                    if (palabraIndex >= palabrasPorLinea) {
                        setTimeout(() => {
                            h2.innerHTML = rawPalabras.join(" ");
                            palabraIndex = 0;
                            lineaActual++;
                        }, tiempo / 2);
                    }

                }, tiempo);

                btnStart.addEventListener("click", () => {
                    clearInterval(intervalo);
                });

            } else {
                pantalla.classList.add("hidden");
            }
        }



    </script>
 </body>
 </html>